## 负环

一个有向/无向图中，环路的边权和<0.因为存在负环，所以最短路的求法中，可以循环无数次

这些环上的点的距离可以变成-INF

### 实现

一般使用SPFA做负环的求解，还可以使用bellmanford。

1. 统计每个点入队次数，如果大于n，则说明存在负环（基本等于bellmanford)
> 总共n个点,则对于点i到其他点最多n-1条边,入队n次说明包含n条让dist[i]变小的边.同时因为更新原则是加上第n条边后最短路权重变小.所以第n条边是负的,则该路径一定存在负环

2. 统计当前最短路中所包含的边数，如果某点的最短路所包含的边数大于等于n，则说明存在环

> n条边 则一定有n+1个点 但我们总共就n个点 所以这条最短路上一定有环.同时因为更新原则是加上第n条边后最短路权重变小.所以第n条边是负的,则该路径一定存在负环

假设有一个长度为n的负环，此时入队n次的判断需要走过这个负环n次。但是根据走过的路径长度是否>=n时的判断只需要遍历负环1次

### 关注点

1. 负环不一定从起点可达，解决方式：所有点入队。理解的方式可以考虑配合虚拟原点。

> 1 虚拟源点0向所有点连一条长度是0的边构成一条新的图,同时以虚拟源点0作为新图的起点

> 2 原图中存在负环 == 新图中存在负环.而新图里所有的负环一定能从虚拟源点出发走到

> 3 那么我们对新图做spfa时就是把虚拟源点0加入queue.而0 pop出来后队列会把所有原图的节点加入queue

### 经验做法

考虑到大多数随机图中spfa的复杂度是O(m) ~ O(nm)。当spfa效率比较低的时候(一直结束不了的时候)
等价于，存在负环（比较tricky的做法，不一定对）

可测量化:当所有点入队次数超过2n,我们就认为图中很大可能存在负环